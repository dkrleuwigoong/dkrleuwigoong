<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jadwal Kegiatan | SIMA DKR</title>
    <link rel="Icon" href="img/dkr-logo.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous" />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet" />

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="css/admin.css" />
  </head>
  <body>
    <aside class="sidebar">
      <div class="sidebar-header">
        <h3>SIMPA</h3>
      </div>

      <ul class="sidebar-menu">
        <li>
          <a href="dashboard.html">
            <span class="material-symbols-outlined">home</span>
            <span>Beranda</span>
          </a>
        </li>

        <li>
          <a href="data-anggota.html">
            <span class="material-symbols-outlined">groups</span>
            <span>Data Anggota</span>
          </a>
        </li>

        <li class="active">
          <a href="jadwal.html">
            <span class="material-symbols-outlined">event</span>
            <span>Jadwal Kegiatan</span>
          </a>
        </li>

        <li>
          <a href="presensi.html">
            <span class="material-symbols-outlined">fact_check</span>
            <span>Presensi</span>
          </a>
        </li>

        <li>
          <a href="#">
            <span class="material-symbols-outlined">description</span>
            <span>Laporan</span>
          </a>
        </li>

        <li>
          <a href="#">
            <span class="material-symbols-outlined">settings</span>
            <span>Pengaturan</span>
          </a>
        </li>
      </ul>
    </aside>
    <nav class="navbar">
      <!-- KIRI : TOGGLE -->
      <div class="navbar-left">
        <button class="btn btn-toggle-sidebar p-0 border-0 bg-transparent">
          <span class="material-symbols-outlined fs-2 text-success">
            menu
          </span>
        </button>
      </div>

      <!-- KANAN : USER -->
      <div class="navbar-right">
        <div class="navbar-user">
          <span class="material-symbols-outlined">account_circle</span>
          <span class="username">Admin SIMPA</span>
        </div>

        <button class="navbar-icon">
          <span class="material-symbols-outlined">notifications</span>
          <span class="notif-badge">3</span>
        </button>

        <button class="navbar-icon logout">
          <span class="material-symbols-outlined">logout</span>
        </button>
      </div>
    </nav>

    <main class="main">
      <div class="card-breadcrumb">
        <div class="breadcrumb-left">
          <span class="material-symbols-outlined">home</span>
          <span class="breadcrumb-separator">/</span>
          <span>Beranda</span>
        </div>
      </div>

      <div class="card-input-jadwal">
        <div class="card-input-jadwal-header">
          <span class="material-symbols-outlined">edit_calendar</span>
          <h3>Input Jadwal Kegiatan</h3>
        </div>

        <form id="formJadwal">
          <div class="card-input-jadwal-body">
            <div class="form-group">
              <label>Nama Kegiatan</label>
              <input type="text" id="namaKegiatan" required />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="tanggal" required />
              </div>

              <div class="form-group">
                <label>Waktu</label>
                <input type="time" id="waktu" required />
              </div>
            </div>

            <div class="form-group">
              <label>Tempat</label>
              <input type="text" id="tempat" required />
            </div>

            <div class="form-group">
              <label>Keterangan</label>
              <textarea id="keterangan" rows="3"></textarea>
            </div>
          </div>

          <div class="card-input-jadwal-footer">
            <button type="reset" class="btn-secondary">
              <span class="material-symbols-outlined">refresh</span>
              Reset
            </button>
            <button type="submit" class="btn-primary">
              <span class="material-symbols-outlined">save</span>
              Simpan Jadwal
            </button>
          </div>
        </form>
      </div>

      <div class="card-jadwal">
        <div class="card-jadwal-header">
          <div class="card-jadwal-title">
            <span class="material-symbols-outlined">event</span>
            <h3>Jadwal Kegiatan</h3>
          </div>
          <span class="material-symbols-outlined">calendar_month</span>
        </div>

        <div class="card-jadwal-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Tanggal</th>
                  <th scope="col">Waktu</th>
                  <th scope="col">Kegiatan</th>
                  <th scope="col">Lokasi</th>
                  <th scope="col">Keterangan</th>
                  <th scope="col">Aksi</th>
                </tr>
              </thead>
              <tbody class="table-group-divider"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <script>
      const sidebar = document.querySelector(".sidebar");

      // Tutup sidebar saat klik menu
      document.querySelectorAll(".sidebar a").forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove("active");
          }
        });
      });

      // Tutup sidebar saat klik di luar sidebar
      document.addEventListener("click", (e) => {
        if (
          window.innerWidth <= 768 &&
          sidebar.classList.contains("active") &&
          !sidebar.contains(e.target) &&
          !e.target.classList.contains("btn-toggle-sidebar")
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Tombol toggle sidebar (hamburger)
      const btnToggle = document.querySelector(".btn-toggle-sidebar");
      if (btnToggle) {
        btnToggle.addEventListener("click", (e) => {
          e.stopPropagation(); // supaya tidak langsung tertutup
          sidebar.classList.toggle("active");
        });
      }
      // --- Variabel DOM ---
      // Toggle sidebar
      function toggleSidebar() {
        document.querySelector(".sidebar").classList.toggle("active");
      }
      const formJadwal = document.getElementById("formJadwal");
      const tbody = document.querySelector(".table tbody");
      const STORAGE_KEY = "dataJadwalKegiatan";

      // =============================
      // Ambil data dari localStorage
      // =============================
      function loadJadwal() {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        tbody.innerHTML = "";

        data.forEach((item) => {
          tambahKeTabel(item);
        });
      }

      // =============================
      // Tambah baris ke tabel
      // =============================
      function tambahKeTabel(item, index) {
        const tr = document.createElement("tr");

        tr.innerHTML = `
    <td>${item.tanggal}</td>
    <td>${item.waktu}</td>
    <td>${item.nama}</td>
    <td>${item.tempat}</td>
    <td>${item.keterangan}</td>
    <td class="text-center">
      <button class="btn btn-sm btn-warning me-1 btn-edit">
        <span class="material-symbols-outlined fs-6">edit</span>
      </button>
      <button class="btn btn-sm btn-danger btn-hapus">
        <span class="material-symbols-outlined fs-6">delete</span>
      </button>
    </td>
  `;

        /* =======================
     EVENT EDIT
  ======================= */
        tr.querySelector(".btn-edit").addEventListener("click", () => {
          document.getElementById("namaKegiatan").value = item.nama;
          document.getElementById("tanggal").value = item.tanggalAsli;
          document.getElementById("waktu").value = item.waktu;
          document.getElementById("tempat").value = item.tempat;
          document.getElementById("keterangan").value = item.keterangan;

          hapusData(index);
        });

        /* =======================
     EVENT HAPUS
  ======================= */
        tr.querySelector(".btn-hapus").addEventListener("click", () => {
          if (confirm("Yakin ingin menghapus jadwal ini?")) {
            hapusData(index);
          }
        });

        tbody.appendChild(tr);
      }

      // =============================
      // Simpan data baru
      // =============================
      formJadwal.addEventListener("submit", function (e) {
        e.preventDefault();

        const nama = document.getElementById("namaKegiatan").value;
        const tanggalInput = document.getElementById("tanggal").value;
        const waktu = document.getElementById("waktu").value;
        const tempat = document.getElementById("tempat").value;
        const keterangan = document.getElementById("keterangan").value || "-";

        const tanggal = new Date(tanggalInput).toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });

        const dataBaru = {
          nama,
          tanggal, // format Indonesia
          tanggalAsli: tanggalInput, // format input date
          waktu,
          tempat,
          keterangan,
        };

        const dataLama = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        dataLama.push(dataBaru);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dataLama));

        tambahKeTabel(dataBaru);
        formJadwal.reset();
      });

      // =============================
      // Load data saat halaman dibuka
      // =============================
      function loadJadwal() {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        tbody.innerHTML = "";

        data.forEach((item, index) => {
          tambahKeTabel(item, index);
        });
      }

      function hapusData(index) {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        data.splice(index, 1);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        loadJadwal();
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"></script>
  </body>
</html>
